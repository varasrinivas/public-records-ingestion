---
title: US Suits Pipeline â€” Medallion Architecture Data Flow
---
flowchart TB
    subgraph SOURCES["ğŸ›ï¸ State Court Data Sources"]
        TX["TX â€” Harris County<br/>Pipe CSV âˆ£ MM/dd/yyyy"]
        CA["CA â€” LA County<br/>Nested JSON âˆ£ yyyy-MM-dd"]
        NY["NY â€” Kings County<br/>Comma CSV âˆ£ MM/dd/yyyy"]
        FL["FL â€” Miami-Dade<br/>CSV âˆ£ yyyyMMdd"]
        IL["IL â€” Cook County<br/>CSV âˆ£ dd-MMM-yyyy"]
        OH["OH â€” Cuyahoga<br/>Tab CSV âˆ£ M/d/yyyy"]
    end

    subgraph BRONZE["ğŸ¥‰ BRONZE LAYER â€” Raw Ingestion"]
        direction TB
        B_INGEST["PySpark Ingester<br/><i>src/bronze/ingest.py</i>"]
        B_META["Metadata Enrichment<br/>_batch_id, _source_state,<br/>_ingestion_timestamp, _row_number"]
        B_STORE[("Parquet on GCS<br/>gs://bucket/bronze/suits/<br/>Partitioned: state / date")]

        B_INGEST --> B_META --> B_STORE
    end

    subgraph QG1["ğŸ” Quality Gate 1 â€” Bronzeâ†’Silver"]
        QC1_NULL["not_null(case_number)"]
        QC1_DATE["parseable(filing_date)"]
        QC1_STATE["valid(state_code)"]
        QC1_PARTY["not_null(plaintiff)"]
    end

    subgraph QUARANTINE["ğŸš« Quarantine"]
        Q_BRONZE["quarantine/bronze/<br/>Failed records + reason"]
    end

    subgraph SILVER["ğŸ¥ˆ SILVER LAYER â€” Canonical Schema"]
        direction TB
        S_MAP["Field Mapping<br/>cause_nbrâ†’case_number<br/>docket_idâ†’case_number<br/>index_numberâ†’case_number"]
        S_DATE["Date Standardization<br/>6 formats â†’ ISO 8601"]
        S_TYPE["Type Harmonization<br/>~40 state codes â†’ 10 canonical"]
        S_STATUS["Status Harmonization<br/>~20 state codes â†’ 8 canonical"]
        S_NAME["Name Normalization<br/>UPPERâ†’Title Case<br/>Entity detection (LLC, Inc)"]
        S_DEDUP["Deduplication<br/>By suit_id, latest wins"]

        S_MAP --> S_DATE --> S_TYPE --> S_STATUS --> S_NAME --> S_DEDUP

        S_SUITS[("silver_suit<br/>Partitioned by state_code")]
        S_PARTIES[("silver_suit_party<br/>Partitioned by party_type")]

        S_DEDUP --> S_SUITS
        S_DEDUP --> S_PARTIES
    end

    subgraph QG2["ğŸ” Quality Gate 2 â€” Silverâ†’Gold"]
        QC2_UNIQUE["unique(suit_id)"]
        QC2_TYPE["accepted_values(case_type)"]
        QC2_STATUS["accepted_values(case_status)"]
        QC2_REF["party_exists_per_suit"]
    end

    subgraph GOLD["ğŸ¥‡ GOLD LAYER â€” Consumer Best Views"]
        direction TB
        G_SUIT["gold_suit_best_view<br/>1 row/suit + enrichments<br/>days_open, year_filed,<br/>primary_plaintiff/defendant"]
        G_PARTY["gold_party_best_view<br/>Cross-suit metrics<br/>is_frequent_litigant"]
        G_STATE["gold_state_summary<br/>state Ã— year Ã— type<br/>suit_count, disposition_rate"]
        G_TREND["gold_monthly_trends<br/>Filing trends<br/>rolling 3m avg, YoY %"]
    end

    subgraph BQ["ğŸ¢ BigQuery"]
        BQ_EXT["External Tables<br/>(Parquet-backed)"]
        BQ_MAT["Materialized Tables<br/>Partitioned by filing_date<br/>Clustered by state_code"]
        BQ_VIEWS["Consumer Views<br/>v_suit_search<br/>v_frequent_litigants<br/>v_state_dashboard"]

        BQ_EXT --> BQ_MAT --> BQ_VIEWS
    end

    subgraph CONSUMERS["ğŸ“Š Consumers"]
        CON_BI["Looker / Tableau"]
        CON_API["REST API"]
        CON_ML["ML Feature Store"]
        CON_SEARCH["Due Diligence Portal"]
    end

    TX & CA & NY & FL & IL & OH --> B_INGEST

    B_STORE --> QG1
    QG1 -->|PASS â‰¥95%| S_MAP
    QG1 -->|FAIL| Q_BRONZE

    S_SUITS & S_PARTIES --> QG2
    QG2 -->|PASS â‰¥98%| G_SUIT & G_PARTY & G_STATE & G_TREND

    G_SUIT & G_PARTY & G_STATE & G_TREND --> BQ_EXT

    BQ_VIEWS --> CON_BI & CON_API & CON_ML & CON_SEARCH

    style SOURCES fill:#0c1a3d,stroke:#1e3a6e,color:#60a5fa
    style BRONZE fill:#451a03,stroke:#d97706,color:#fbbf24
    style QG1 fill:#064e3b,stroke:#10b981,color:#34d399
    style QG2 fill:#064e3b,stroke:#10b981,color:#34d399
    style QUARANTINE fill:#7f1d1d,stroke:#ef4444,color:#fca5a5
    style SILVER fill:#1e293b,stroke:#64748b,color:#e2e8f0
    style GOLD fill:#422006,stroke:#eab308,color:#fef08a
    style BQ fill:#1a2236,stroke:#3b82f6,color:#93c5fd
    style CONSUMERS fill:#2e1065,stroke:#7c3aed,color:#c4b5fd
